<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Interactiva: √Ålgebra Cafetera</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
        h1, h2, h3, h4 { font-family: 'Poppins', sans-serif; }
        .serif { font-family: 'Lora', serif; }
        .math-var { font-family: 'Courier New', monospace; font-weight: bold; color: #d97706; background: #fffbeb; padding: 0 4px; border-radius: 4px; }
        .print-break { page-break-before: always; }
        
        /* Estilos feedback */
        .correct-answer { background-color: #dcfce7; border-color: #22c55e; }
        .wrong-answer { background-color: #fee2e2; border-color: #ef4444; }
        
        @media print {
            .no-print { display: none; }
            body { background: white; }
            .shadow-lg, .shadow-xl { box-shadow: none; }
            .border { border: 1px solid #ccc; }
            .bg-stone-50 { background-color: white; }
            #results-container { display: block !important; }
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">

    <!-- HEADER CON LOGO -->
    <header class="bg-amber-700 text-white pt-8 pb-8 px-4 shadow-xl">
        <div class="max-w-4xl mx-auto text-center">
            <img src="https://res.cloudinary.com/dgqpeth4f/image/upload/v1748483304/logo_aaa_hvqghu.png" alt="Logo CafeLab" class="mx-auto w-48 md:w-64 mb-6 bg-white p-3 rounded-xl shadow-lg">
            <h1 class="text-3xl md:text-5xl font-bold mb-2">Matem√°ticas con Aroma de Caf√©</h1>
            <h2 class="text-xl md:text-2xl font-light text-amber-200">Gu√≠a Interactiva Paso a Paso</h2>
        </div>
    </header>

    <!-- INTRODUCCI√ìN (Resumida para ahorrar espacio en este ejemplo) -->
    <section class="max-w-4xl mx-auto px-4 py-8">
        <div class="bg-white p-6 rounded-2xl shadow border-l-8 border-green-500">
            <h3 class="text-xl font-bold text-gray-800 mb-2">üëã Hola Estudiante</h3>
            <p class="text-gray-600">Bienvenido a tu evaluaci√≥n de √Ålgebra Cafetera.</p>
        </div>
    </section>

    <!-- TEST INTERACTIVO -->
    <section class="max-w-4xl mx-auto px-4 py-12 print-break" id="test-section">
        <div class="border-2 border-stone-300 p-6 md:p-8 rounded-xl bg-white shadow-sm relative">
            
            <!-- DATOS DEL ESTUDIANTE (NUEVO CAMPO GRADO) -->
            <div class="text-center mb-8 border-b-2 border-stone-100 pb-4">
                <h2 class="text-3xl font-bold text-amber-800">üìù Examen de Certificaci√≥n</h2>
                <p class="text-gray-500 mb-6">Completa tus datos para iniciar</p>
                
                <div class="grid md:grid-cols-2 gap-4 max-w-2xl mx-auto">
                    <div>
                        <label class="block text-left text-sm font-bold text-gray-700 mb-1">Nombre Completo:</label>
                        <input type="text" id="studentName" class="w-full p-2 border border-gray-300 rounded focus:border-amber-500 outline-none" placeholder="Ej: Pepito P√©rez">
                    </div>
                    <div>
                        <label class="block text-left text-sm font-bold text-gray-700 mb-1">Grado / Curso:</label>
                        <input type="text" id="studentGrade" class="w-full p-2 border border-gray-300 rounded focus:border-amber-500 outline-none" placeholder="Ej: 901">
                    </div>
                </div>
            </div>

            <form id="quizForm">
                <div class="grid md:grid-cols-2 gap-6 md:gap-x-12">
                    
                    <!-- PARTE 1 -->
                    <div class="col-span-2 mb-2 bg-green-100 p-2 rounded text-green-800 font-bold text-sm">PARTE 1: TRADUCCI√ìN B√ÅSICA</div>

                    <!-- P1 -->
                    <div class="question-box" id="q1-box">
                        <p class="font-bold mb-2">1. Si <span class="math-var">p</span> es el precio, ¬øc√≥mo escribes "El precio aument√≥ 500 pesos"?</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q1" value="a" class="mr-2"> a) 500p</label>
                            <label class="block cursor-pointer"><input type="radio" name="q1" value="b" class="mr-2"> b) p + 500</label>
                            <label class="block cursor-pointer"><input type="radio" name="q1" value="c" class="mr-2"> c) p - 500</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P2 -->
                    <div class="question-box" id="q2-box">
                        <p class="font-bold mb-2">2. ¬øC√≥mo escribes "El triple de la producci√≥n (<span class="math-var">x</span>)"?</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q2" value="a" class="mr-2"> a) 3 + x</label>
                            <label class="block cursor-pointer"><input type="radio" name="q2" value="b" class="mr-2"> b) x¬≥</label>
                            <label class="block cursor-pointer"><input type="radio" name="q2" value="c" class="mr-2"> c) 3x</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P3 -->
                    <div class="question-box" id="q3-box">
                        <p class="font-bold mb-2">3. "La cosecha (<span class="math-var">c</span>) tuvo una merma (p√©rdida) de 10 kilos".</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q3" value="a" class="mr-2"> a) c - 10</label>
                            <label class="block cursor-pointer"><input type="radio" name="q3" value="b" class="mr-2"> b) 10 - c</label>
                            <label class="block cursor-pointer"><input type="radio" name="q3" value="c" class="mr-2"> c √∑ 10</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P4 -->
                    <div class="question-box" id="q4-box">
                        <p class="font-bold mb-2">4. "Repartir las ganancias (<span class="math-var">g</span>) entre 4 socios".</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q4" value="a" class="mr-2"> a) 4g</label>
                            <label class="block cursor-pointer"><input type="radio" name="q4" value="b" class="mr-2"> b) g - 4</label>
                            <label class="block cursor-pointer"><input type="radio" name="q4" value="c" class="mr-2"> c) g / 4</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- PARTE 2 -->
                    <div class="col-span-2 my-2 bg-amber-100 p-2 rounded text-amber-800 font-bold text-sm">PARTE 2: JERARQU√çA Y ORDEN</div>

                    <!-- P5 -->
                    <div class="question-box" id="q5-box">
                        <p class="font-bold mb-2">5. Selecciona: "El doble de la suma de peso (<span class="math-var">w</span>) m√°s 5".</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q5" value="a" class="mr-2"> a) 2w + 5</label>
                            <label class="block cursor-pointer"><input type="radio" name="q5" value="b" class="mr-2"> b) 2(w + 5)</label>
                            <label class="block cursor-pointer"><input type="radio" name="q5" value="c" class="mr-2"> c) 2 + w + 5</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P6 -->
                    <div class="question-box" id="q6-box">
                        <p class="font-bold mb-2">6. Si la f√≥rmula es <span class="math-var">100 - 2x</span>, y <span class="math-var">x = 10</span>. ¬øResultado?</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q6" value="a" class="mr-2"> a) 80 (Multiplico 2¬∑10, luego resto)</label>
                            <label class="block cursor-pointer"><input type="radio" name="q6" value="b" class="mr-2"> b) 980 (Resto 100-2, luego multiplico)</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P7 -->
                    <div class="question-box" id="q7-box">
                        <p class="font-bold mb-2">7. Lectura Cr√≠tica: "Mitad de precio (<span class="math-var">p</span>), m√°s el impuesto (<span class="math-var">t</span>)".</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q7" value="a" class="mr-2"> a) (p / 2) + t</label>
                            <label class="block cursor-pointer"><input type="radio" name="q7" value="b" class="mr-2"> b) (p + t) / 2</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- PARTE 3 -->
                    <div class="col-span-2 my-2 bg-purple-100 p-2 rounded text-purple-800 font-bold text-sm">PARTE 3: RESOLUCI√ìN Y SISTEMAS</div>

                    <!-- P8 -->
                    <div class="question-box" id="q8-box">
                        <p class="font-bold mb-2">8. Resuelve: Si <span class="math-var">3x = 1500</span>, ¬øCu√°nto vale <span class="math-var">x</span>?</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q8" value="a" class="mr-2"> a) x = 500</label>
                            <label class="block cursor-pointer"><input type="radio" name="q8" value="b" class="mr-2"> b) x = 4500</label>
                            <label class="block cursor-pointer"><input type="radio" name="q8" value="c" class="mr-2"> c) x = 1497</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P9 (Texto) -->
                    <div class="col-span-2 question-box" id="q9-box">
                        <p class="font-bold mb-2">9. Tienes Caf√© Rojo (<span class="math-var">R</span>) y Caf√© Verde (<span class="math-var">V</span>). Entre los dos suman 50 sacos. Escribe la ecuaci√≥n (ejemplo: A+B=20).</p>
                        <input type="text" id="q9_input" class="w-full border-b-2 border-gray-300 p-1 focus:border-amber-500 outline-none font-mono" placeholder="Tu respuesta...">
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P10 (Multiple) -->
                    <div class="col-span-2 bg-stone-50 p-4 rounded border border-stone-200 question-box" id="q10-box">
                        <p class="font-bold mb-2">10. El Reto del Comerciante</p>
                        <p class="text-sm text-gray-600 mb-3">
                            "Compr√© L√°pices (<span class="math-var">L</span>) a 500 y Borradores (<span class="math-var">B</span>) a 200. Compr√© 10 art√≠culos en total y pagu√© 3800 pesos". <br>
                            <strong>Selecciona las DOS ecuaciones correctas:</strong>
                        </p>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <label class="flex items-center cursor-pointer"><input type="checkbox" name="q10" value="a" class="mr-2"> a) L + B = 3800</label>
                            <label class="flex items-center cursor-pointer"><input type="checkbox" name="q10" value="b" class="mr-2"> b) 500L + 200B = 3800</label>
                            <label class="flex items-center cursor-pointer"><input type="checkbox" name="q10" value="c" class="mr-2"> c) 500L + 200B = 10</label>
                            <label class="flex items-center cursor-pointer"><input type="checkbox" name="q10" value="d" class="mr-2"> d) L + B = 10</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>
                </div>

                <!-- Botones -->
                <div class="mt-8 text-center flex flex-col md:flex-row gap-4 justify-center no-print">
                    <button type="button" onclick="calculateScore()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all">
                        ‚úÖ Calificar y Enviar
                    </button>
                    <button type="button" onclick="window.print()" class="bg-amber-800 hover:bg-amber-900 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all">
                        üñ®Ô∏è Imprimir
                    </button>
                </div>
            </form>

            <!-- RESULTADOS -->
            <div id="results-area" class="hidden mt-8 p-6 bg-stone-100 rounded-xl border border-stone-300 text-center">
                <h3 class="text-2xl font-bold text-amber-900 mb-2">Resultados de <span id="res-name"></span></h3>
                <div class="text-4xl font-bold mb-4" id="res-score">0 / 10</div>
                <p id="res-msg" class="text-gray-700 font-medium"></p>
                <p class="text-sm text-gray-500 mt-2">Revisa las correcciones arriba ‚¨ÜÔ∏è</p>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="bg-stone-900 text-stone-400 py-8 text-center mt-12 no-print">
        <p class="text-sm">¬© 2023 CafeLab Educaci√≥n.</p>
    </footer>

    <!-- L√ìGICA JAVASCRIPT -->
    <script>
        // *** ASEG√öRATE DE QUE ESTA URL SEA LA DE TU NUEVA IMPLEMENTACI√ìN ***
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycby8RZ3TxQSm8yOsb3JtAT0EwKMQF3cehZnVqNSnPiN_ew3gyEknFD96CL2pvG575gm9zg/exec";

        const correctAnswers = {
            q1: { ans: 'b', explain: 'Correcto: "Aumentar" significa sumar. p + 500.' },
            q2: { ans: 'c', explain: 'Correcto: "El triple" es multiplicar por 3. (3x).' },
            q3: { ans: 'a', explain: 'Correcto: "Merma" es resta. c - 10.' },
            q4: { ans: 'c', explain: 'Correcto: "Repartir" es dividir. g / 4.' },
            q5: { ans: 'b', explain: 'Correcto: Agrupar la suma (w+5) antes de duplicar.' },
            q6: { ans: 'a', explain: 'Correcto: Jerarqu√≠a: 2x10=20, luego 100-20=80.' },
            q7: { ans: 'a', explain: 'Correcto: Separar: (p/2) + t.' },
            q8: { ans: 'a', explain: 'Correcto: 1500 / 3 = 500.' },
            q9: { ans: ['r+v=50', 'v+r=50'], explain: 'Correcto: Suma de cantidades.' },
            q10: { ans: ['b', 'd'], explain: 'Correcto: Una ec. de cantidad y otra de dinero.' }
        };

        function calculateScore() {
            const nameInput = document.getElementById('studentName').value;
            const gradeInput = document.getElementById('studentGrade').value;

            // Validaci√≥n mejorada
            if (!nameInput.trim() || !gradeInput.trim()) {
                alert("‚ö†Ô∏è Por favor, escribe tu NOMBRE y tu GRADO antes de calificar.");
                return;
            }

            const btn = document.querySelector('button[onclick="calculateScore()"]');
            btn.innerHTML = "‚è≥ Procesando...";
            btn.disabled = true;

            let score = 0;
            const form = document.getElementById('quizForm');
            let respuestasRaw = {}; // Objeto para enviar al excel solo las letras

            // Limpiar feedback
            document.querySelectorAll('.feedback').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');
                el.parentElement.classList.remove('correct-answer', 'wrong-answer', 'border-2', 'p-2');
            });

            // --- EVALUAR Q1 A Q8 ---
            for (let i = 1; i <= 8; i++) {
                const qKey = 'q' + i;
                const selected = form.querySelector(`input[name="${qKey}"]:checked`);
                const box = document.getElementById(qKey + '-box');
                const feedbackDiv = box.querySelector('.feedback');
                
                let val = selected ? selected.value : "";
                respuestasRaw[qKey] = val; // Guardamos solo la letra para el excel

                let isCorrect = false;
                if (selected && selected.value === correctAnswers[qKey].ans) {
                    isCorrect = true;
                    score++;
                }

                // Feedback Visual
                box.classList.add('border-2', 'p-2', 'rounded');
                feedbackDiv.classList.remove('hidden');
                if (isCorrect) {
                    box.classList.add('correct-answer');
                    feedbackDiv.innerHTML = `‚úÖ ${correctAnswers[qKey].explain}`;
                    feedbackDiv.classList.add('bg-green-100', 'text-green-800');
                } else {
                    box.classList.add('wrong-answer');
                    feedbackDiv.innerHTML = `‚ùå Error. ${correctAnswers[qKey].explain}`;
                    feedbackDiv.classList.add('bg-red-100', 'text-red-800');
                }
            }

            // --- EVALUAR Q9 ---
            const q9Input = document.getElementById('q9_input').value;
            respuestasRaw['q9'] = q9Input;

            const q9Clean = q9Input.toLowerCase().replace(/\s/g, '');
            const q9Valid = correctAnswers.q9.ans.map(a => a.replace(/\s/g, ''));
            const q9Box = document.getElementById('q9-box');
            const q9Feedback = q9Box.querySelector('.feedback');
            q9Box.classList.add('border-2', 'p-2', 'rounded');
            q9Feedback.classList.remove('hidden');

            if (q9Valid.includes(q9Clean)) {
                score++;
                q9Box.classList.add('correct-answer');
                q9Feedback.innerHTML = `‚úÖ ${correctAnswers.q9.explain}`;
                q9Feedback.classList.add('bg-green-100', 'text-green-800');
            } else {
                q9Box.classList.add('wrong-answer');
                q9Feedback.innerHTML = `‚ùå Respuesta esperada: R + V = 50`;
                q9Feedback.classList.add('bg-red-100', 'text-red-800');
            }

            // --- EVALUAR Q10 ---
            const q10Selected = Array.from(form.querySelectorAll('input[name="q10"]:checked')).map(cb => cb.value);
            respuestasRaw['q10'] = q10Selected.join(','); // Enviamos "b,d" para el excel

            const correctSet = correctAnswers.q10.ans;
            const isQ10Correct = q10Selected.length === 2 && q10Selected.every(val => correctSet.includes(val));
            const q10Box = document.getElementById('q10-box');
            const q10Feedback = q10Box.querySelector('.feedback');
            q10Box.classList.add('border-2', 'p-2', 'rounded');
            q10Feedback.classList.remove('hidden');

            if (isQ10Correct) {
                score++;
                q10Box.classList.add('correct-answer');
                q10Feedback.innerHTML = `‚úÖ ${correctAnswers.q10.explain}`;
                q10Feedback.classList.add('bg-green-100', 'text-green-800');
            } else {
                q10Box.classList.add('wrong-answer');
                q10Feedback.innerHTML = `‚ùå Selecci√≥n incorrecta.`;
                q10Feedback.classList.add('bg-red-100', 'text-red-800');
            }

            // --- MOSTRAR RESULTADOS LOCALES ---
            const resultsArea = document.getElementById('results-area');
            resultsArea.classList.remove('hidden');
            document.getElementById('res-name').textContent = nameInput;
            document.getElementById('res-score').textContent = score + " / 10";
            
            const msgEl = document.getElementById('res-msg');
            if(score === 10) msgEl.textContent = "¬°Excelente!";
            else msgEl.textContent = "Sigue practicando.";
            resultsArea.scrollIntoView({ behavior: 'smooth' });

            // --- ENVIAR DATOS LIMPIOS AL BACKEND ---
            const dataToSend = JSON.stringify({
                nombre: nameInput,
                grado: gradeInput,
                puntaje: score,
                // Esparcimos las respuestas raw
                q1: respuestasRaw.q1, q2: respuestasRaw.q2, q3: respuestasRaw.q3, q4: respuestasRaw.q4,
                q5: respuestasRaw.q5, q6: respuestasRaw.q6, q7: respuestasRaw.q7, q8: respuestasRaw.q8,
                q9: respuestasRaw.q9, q10: respuestasRaw.q10
            });

            fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                mode: "no-cors", 
                headers: { "Content-Type": "application/json" },
                body: dataToSend
            }).then(() => {
                btn.innerHTML = "‚úÖ Datos Guardados";
                alert(`¬°Examen enviado!\nEstudiante: ${nameInput}\nGrado: ${gradeInput}\nNota: ${score}/10`);
            }).catch(err => {
                console.error("Error env√≠o", err);
                btn.innerHTML = "‚ö†Ô∏è Error de Red";
                alert("Se calific√≥, pero hubo un error al guardar en la nube.");
            });
        }
    </script>

</body>
</html>
