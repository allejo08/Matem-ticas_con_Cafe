<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Interactiva: √Ålgebra Cafetera</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
        h1, h2, h3, h4 { font-family: 'Poppins', sans-serif; }
        .serif { font-family: 'Lora', serif; }
        /* Estilo para las variables matem√°ticas */
        .math-var { font-family: 'Courier New', monospace; font-weight: bold; color: #d97706; background: #fffbeb; padding: 0 4px; border-radius: 4px; }
        .print-break { page-break-before: always; }
        
        /* Estilos para feedback del examen */
        .correct-answer { background-color: #dcfce7; border-color: #22c55e; }
        .wrong-answer { background-color: #fee2e2; border-color: #ef4444; }
        
        @media print {
            .no-print { display: none; }
            body { background: white; }
            .shadow-lg, .shadow-xl { box-shadow: none; }
            .border { border: 1px solid #ccc; }
            .bg-stone-50 { background-color: white; }
            #results-container { display: block !important; }
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">

    <!-- HEADER CON LOGO -->
    <header class="bg-amber-700 text-white pt-8 pb-8 px-4 shadow-xl">
        <div class="max-w-4xl mx-auto text-center">
            
            <!-- LOGO CAFELAB -->
            <img src="https://res.cloudinary.com/dgqpeth4f/image/upload/v1748483304/logo_aaa_hvqghu.png" alt="Logo CafeLab" class="mx-auto w-48 md:w-64 mb-6 bg-white p-3 rounded-xl shadow-lg">

            <h1 class="text-3xl md:text-5xl font-bold mb-2">Matem√°ticas con Aroma de Caf√©</h1>
            <h2 class="text-xl md:text-2xl font-light text-amber-200">Gu√≠a Interactiva Paso a Paso</h2>
            <div class="mt-6 flex flex-wrap justify-center gap-3 text-sm font-medium">
                <span class="bg-green-600 px-3 py-1 rounded-full">Nivel 1: B√°sico</span>
                <span class="bg-amber-600 px-3 py-1 rounded-full">Nivel 2: Intermedio</span>
                <span class="bg-red-600 px-3 py-1 rounded-full">Nivel 3: Avanzado</span>
            </div>
        </div>
    </header>

    <!-- INTRODUCCI√ìN -->
    <section class="max-w-4xl mx-auto px-4 py-8">
        <div class="bg-white p-6 rounded-2xl shadow border-l-8 border-green-500">
            <h3 class="text-xl font-bold text-gray-800 mb-2">üëã Hola Estudiante</h3>
            <p class="text-gray-600">
                El √°lgebra no es dif√≠cil, solo es un idioma diferente. En esta gu√≠a no usaremos t√©rminos extra√±os desde el principio. 
                Imagina que la letra <span class="math-var">x</span> es simplemente una caja cerrada o un saco de caf√© del cual no sabemos el peso exacto.
                Vamos a aprender a "leer" matem√°ticas.
            </p>
        </div>
    </section>

    <!-- NIVEL 1 -->
    <section class="max-w-4xl mx-auto px-4 mb-10">
        <div class="flex items-center gap-3 mb-4">
            <span class="bg-green-600 text-white font-bold px-3 py-1 rounded text-sm">NIVEL 1</span>
            <h2 class="text-2xl font-bold text-gray-800">¬øQu√© es una Variable?</h2>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
            <div class="bg-white p-5 rounded-xl border border-gray-200">
                <h4 class="font-bold text-amber-800 mb-2">Aritm√©tica (Lo que ya sabes)</h4>
                <p class="text-sm text-gray-600 mb-3">Trabajas con n√∫meros conocidos.</p>
                <div class="bg-gray-100 p-3 rounded text-center font-mono text-lg">
                    5 kilos + 2 kilos = 7 kilos
                </div>
            </div>

            <div class="bg-white p-5 rounded-xl border-2 border-green-500 shadow-md">
                <h4 class="font-bold text-green-700 mb-2">√Ålgebra (Lo nuevo)</h4>
                <p class="text-sm text-gray-600 mb-3">Trabajas con valores desconocidos (Sacos).</p>
                <div class="bg-green-50 p-3 rounded text-center font-mono text-lg font-bold text-green-800">
                    Saco + 2 kilos = 7 kilos
                </div>
                <p class="text-xs text-center mt-2 text-gray-500">
                    Si al saco le sumas 2 y da 7...<br>
                    <strong>¬øCu√°nto pesa el saco? (Respuesta: 5)</strong>
                </p>
            </div>
        </div>
        
        <div class="mt-4 bg-yellow-50 p-4 rounded-lg border border-yellow-200">
            <p class="text-sm">üí° <strong>Tip:</strong> En matem√°ticas, por pereza de escribir "Saco", usamos la letra <span class="math-var">x</span>. <br>Entonces escribimos: <code class="font-bold">x + 2 = 7</code>.</p>
        </div>
    </section>

    <!-- NIVEL 2 CON TABLA ACTUALIZADA -->
    <section class="max-w-4xl mx-auto px-4 mb-10">
        <div class="flex items-center gap-3 mb-4">
            <span class="bg-amber-600 text-white font-bold px-3 py-1 rounded text-sm">NIVEL 2</span>
            <h2 class="text-2xl font-bold text-gray-800">Traduciendo Palabras a S√≠mbolos</h2>
        </div>

        <p class="mb-4 text-gray-700">Para resolver problemas reales, primero debes traducirlos del espa√±ol al "Matem√°tico". Aqu√≠ tienes tu diccionario:</p>

        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse bg-white rounded-lg shadow overflow-hidden">
                <thead class="bg-amber-800 text-white">
                    <tr>
                        <th class="p-3 text-sm">Palabra Clave</th>
                        <th class="p-3 text-sm text-center">Operaci√≥n</th>
                        <th class="p-3 text-sm">Ejemplo Cafetero</th>
                        <th class="p-3 text-sm">Traducci√≥n</th>
                    </tr>
                </thead>
                <tbody class="text-sm text-gray-700 divide-y divide-gray-200">
                    <tr class="bg-green-50">
                        <td class="p-3 font-semibold">Aumentar, Agregar, Ganar</td>
                        <td class="p-3 text-center font-bold text-lg text-green-700">+ (Sumar)</td>
                        <td class="p-3">Un saco (<span class="math-var">x</span>) aumenta 2 kilos</td>
                        <td class="p-3 font-mono font-bold">x + 2</td>
                    </tr>
                    <tr>
                        <td class="p-3 font-semibold">Disminuir, Perder, Merma</td>
                        <td class="p-3 text-center font-bold text-lg text-red-700">- (Restar)</td>
                        <td class="p-3">Un saco (<span class="math-var">x</span>) pierde 5 kilos</td>
                        <td class="p-3 font-mono font-bold">x - 5</td>
                    </tr>
                    <tr class="bg-blue-50">
                        <td class="p-3 font-semibold">Doble, Triple, Veces</td>
                        <td class="p-3 text-center font-bold text-lg text-blue-700">¬∑ (Multiplicar)</td>
                        <td class="p-3">El doble de la cosecha (<span class="math-var">c</span>)</td>
                        <td class="p-3 font-mono font-bold">2c</td>
                    </tr>
                    <tr>
                        <td class="p-3 font-semibold">Mitad, Repartir</td>
                        <td class="p-3 text-center font-bold text-lg text-purple-700">√∑ (Dividir)</td>
                        <td class="p-3">La mitad del precio (<span class="math-var">p</span>)</td>
                        <td class="p-3 font-mono font-bold">p / 2</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- NIVEL 3 -->
    <section class="max-w-4xl mx-auto px-4 mb-10">
        <div class="flex items-center gap-3 mb-4">
            <span class="bg-red-600 text-white font-bold px-3 py-1 rounded text-sm">NIVEL 3</span>
            <h2 class="text-2xl font-bold text-gray-800">El Poder de la Coma (Jerarqu√≠a)</h2>
        </div>

        <div class="bg-white p-6 rounded-xl shadow border border-gray-200">
            <p class="mb-4">
                El par√©ntesis <strong>( )</strong> sirve para agrupar acciones que van juntas. Observa la diferencia:
            </p>

            <div class="grid md:grid-cols-2 gap-8">
                <!-- Caso 1 -->
                <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-bold text-red-800">CASO A: Sin agrupar</h4>
                    </div>
                    <p class="italic text-sm mb-2">"Quiero el doble de la producci√≥n, m√°s 10 sacos".</p>
                    <div class="mt-3 text-center font-mono font-bold text-xl text-red-600">
                        2x + 10
                    </div>
                    <p class="text-xs text-center mt-1">Multiplicas primero, sumas despu√©s.</p>
                </div>

                <!-- Caso 2 -->
                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-bold text-green-800">CASO B: Agrupado</h4>
                    </div>
                    <p class="italic text-sm mb-2">"Quiero el doble de: la producci√≥n m√°s 10 sacos".</p>
                    <div class="mt-3 text-center font-mono font-bold text-xl text-green-600">
                        2(x + 10)
                    </div>
                    <p class="text-xs text-center mt-1">Sumas primero, luego duplicas el total.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- NIVEL 4 -->
    <section class="max-w-4xl mx-auto px-4 py-8 bg-stone-800 text-stone-100 rounded-2xl mb-12 shadow-2xl">
        <div class="flex items-center gap-3 mb-6">
            <span class="bg-purple-600 text-white font-bold px-3 py-1 rounded text-sm">NIVEL 4</span>
            <h2 class="text-2xl font-bold text-white">Reto Final: El Mezclador</h2>
        </div>

        <p class="mb-6 text-stone-300">
            A veces no tenemos una sola inc√≥gnita, sino dos (<span class="math-var text-black">A</span> y <span class="math-var text-black">B</span>).
        </p>

        <div class="grid md:grid-cols-2 gap-8">
            <!-- Datos -->
            <div>
                <h4 class="text-amber-400 font-bold text-lg mb-3">üìã Los Datos</h4>
                <ul class="space-y-4 text-sm">
                    <li class="flex items-center gap-3">
                        <div class="bg-red-500 w-8 h-8 rounded-full flex items-center justify-center font-bold">A</div>
                        <div>Caf√© Calidad A (20 pesos/kilo)</div>
                    </li>
                    <li class="flex items-center gap-3">
                        <div class="bg-blue-500 w-8 h-8 rounded-full flex items-center justify-center font-bold">B</div>
                        <div>Caf√© Calidad B (10 pesos/kilo)</div>
                    </li>
                    <li class="bg-stone-700 p-2 rounded border border-stone-600">
                        <strong>Meta:</strong> Mezcla de <span class="text-amber-300">10 kilos</span> que cueste <span class="text-green-300">160 pesos</span>.
                    </li>
                </ul>
            </div>

            <!-- Soluci√≥n -->
            <div class="bg-stone-700 p-4 rounded-xl border border-stone-600">
                <h4 class="text-white font-bold mb-3">‚öôÔ∏è Las Ecuaciones</h4>
                
                <p class="text-sm text-stone-300 mb-1">1. Ecuaci√≥n de KILOS:</p>
                <div class="bg-stone-900 p-2 rounded text-center font-mono text-amber-300 mb-3">A + B = 10</div>

                <p class="text-sm text-stone-300 mb-1">2. Ecuaci√≥n de DINERO:</p>
                <div class="bg-stone-900 p-2 rounded text-center font-mono text-green-300 mb-3">20A + 10B = 160</div>
            </div>
        </div>
    </section>

    <!-- TEST INTERACTIVO -->
    <section class="max-w-4xl mx-auto px-4 py-12 print-break" id="test-section">
        <div class="border-2 border-stone-300 p-6 md:p-8 rounded-xl bg-white shadow-sm relative">
            
            <!-- Formulario de Datos -->
            <div class="text-center mb-8 border-b-2 border-stone-100 pb-4">
                <h2 class="text-3xl font-bold text-amber-800">üìù Examen de Certificaci√≥n</h2>
                <p class="text-gray-500 mb-4">Demuestra que dominas el √°lgebra cafetera</p>
                
                <div class="max-w-md mx-auto">
                    <label class="block text-left text-sm font-bold text-gray-700 mb-1">Nombre del Estudiante:</label>
                    <input type="text" id="studentName" class="w-full p-2 border border-gray-300 rounded focus:border-amber-500 outline-none" placeholder="Escribe tu nombre aqu√≠...">
                </div>
            </div>

            <form id="quizForm">
                <!-- GRID DE PREGUNTAS -->
                <div class="grid md:grid-cols-2 gap-6 md:gap-x-12">
                    
                    <!-- PARTE 1 -->
                    <div class="col-span-2 mb-2 bg-green-100 p-2 rounded text-green-800 font-bold text-sm">PARTE 1: TRADUCCI√ìN B√ÅSICA</div>

                    <!-- P1 -->
                    <div class="question-box" id="q1-box">
                        <p class="font-bold mb-2">1. Si <span class="math-var">p</span> es el precio, ¬øc√≥mo escribes "El precio aument√≥ 500 pesos"?</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q1" value="a" class="mr-2"> 500p</label>
                            <label class="block cursor-pointer"><input type="radio" name="q1" value="b" class="mr-2"> p + 500</label>
                            <label class="block cursor-pointer"><input type="radio" name="q1" value="c" class="mr-2"> p - 500</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P2 -->
                    <div class="question-box" id="q2-box">
                        <p class="font-bold mb-2">2. ¬øC√≥mo escribes "El triple de la producci√≥n (<span class="math-var">x</span>)"?</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q2" value="a" class="mr-2"> 3 + x</label>
                            <label class="block cursor-pointer"><input type="radio" name="q2" value="b" class="mr-2"> x¬≥</label>
                            <label class="block cursor-pointer"><input type="radio" name="q2" value="c" class="mr-2"> 3x</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P3 -->
                    <div class="question-box" id="q3-box">
                        <p class="font-bold mb-2">3. "La cosecha (<span class="math-var">c</span>) tuvo una merma (p√©rdida) de 10 kilos".</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q3" value="a" class="mr-2"> c - 10</label>
                            <label class="block cursor-pointer"><input type="radio" name="q3" value="b" class="mr-2"> 10 - c</label>
                            <label class="block cursor-pointer"><input type="radio" name="q3" value="c" class="mr-2"> c √∑ 10</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P4 -->
                    <div class="question-box" id="q4-box">
                        <p class="font-bold mb-2">4. "Repartir las ganancias (<span class="math-var">g</span>) entre 4 socios".</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q4" value="a" class="mr-2"> 4g</label>
                            <label class="block cursor-pointer"><input type="radio" name="q4" value="b" class="mr-2"> g - 4</label>
                            <label class="block cursor-pointer"><input type="radio" name="q4" value="c" class="mr-2"> g / 4</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- PARTE 2 -->
                    <div class="col-span-2 my-2 bg-amber-100 p-2 rounded text-amber-800 font-bold text-sm">PARTE 2: JERARQU√çA Y ORDEN</div>

                    <!-- P5 -->
                    <div class="question-box" id="q5-box">
                        <p class="font-bold mb-2">5. Selecciona: "El doble de la suma de peso (<span class="math-var">w</span>) m√°s 5".</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q5" value="a" class="mr-2"> 2w + 5</label>
                            <label class="block cursor-pointer"><input type="radio" name="q5" value="b" class="mr-2"> 2(w + 5)</label>
                            <label class="block cursor-pointer"><input type="radio" name="q5" value="c" class="mr-2"> 2 + w + 5</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P6 -->
                    <div class="question-box" id="q6-box">
                        <p class="font-bold mb-2">6. Si la f√≥rmula es <span class="math-var">100 - 2x</span>, y <span class="math-var">x = 10</span>. ¬øResultado?</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q6" value="a" class="mr-2"> 80 (Multiplico 2¬∑10, luego resto)</label>
                            <label class="block cursor-pointer"><input type="radio" name="q6" value="b" class="mr-2"> 980 (Resto 100-2, luego multiplico)</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P7 -->
                    <div class="question-box" id="q7-box">
                        <p class="font-bold mb-2">7. Lectura Cr√≠tica: "Mitad de precio (<span class="math-var">p</span>), m√°s el impuesto (<span class="math-var">t</span>)".</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q7" value="a" class="mr-2"> (p / 2) + t</label>
                            <label class="block cursor-pointer"><input type="radio" name="q7" value="b" class="mr-2"> (p + t) / 2</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- PARTE 3 -->
                    <div class="col-span-2 my-2 bg-purple-100 p-2 rounded text-purple-800 font-bold text-sm">PARTE 3: RESOLUCI√ìN Y SISTEMAS</div>

                    <!-- P8 -->
                    <div class="question-box" id="q8-box">
                        <p class="font-bold mb-2">8. Resuelve: Si <span class="math-var">3x = 1500</span>, ¬øCu√°nto vale <span class="math-var">x</span>?</p>
                        <div class="space-y-1 text-sm">
                            <label class="block cursor-pointer"><input type="radio" name="q8" value="a" class="mr-2"> x = 500</label>
                            <label class="block cursor-pointer"><input type="radio" name="q8" value="b" class="mr-2"> x = 4500</label>
                            <label class="block cursor-pointer"><input type="radio" name="q8" value="c" class="mr-2"> x = 1497</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P9 (Texto) -->
                    <div class="col-span-2 question-box" id="q9-box">
                        <p class="font-bold mb-2">9. Tienes Caf√© Rojo (<span class="math-var">R</span>) y Caf√© Verde (<span class="math-var">V</span>). Entre los dos suman 50 sacos. Escribe la ecuaci√≥n (ejemplo: A+B=20).</p>
                        <input type="text" id="q9_input" class="w-full border-b-2 border-gray-300 p-1 focus:border-amber-500 outline-none font-mono" placeholder="Tu respuesta...">
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>

                    <!-- P10 (Multiple) -->
                    <div class="col-span-2 bg-stone-50 p-4 rounded border border-stone-200 question-box" id="q10-box">
                        <p class="font-bold mb-2">10. El Reto del Comerciante</p>
                        <p class="text-sm text-gray-600 mb-3">
                            "Compr√© L√°pices (<span class="math-var">L</span>) a 500 y Borradores (<span class="math-var">B</span>) a 200. Compr√© 10 art√≠culos en total y pagu√© 3800 pesos". <br>
                            <strong>Selecciona las DOS ecuaciones correctas:</strong>
                        </p>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <label class="flex items-center cursor-pointer"><input type="checkbox" name="q10" value="a" class="mr-2"> L + B = 3800</label>
                            <label class="flex items-center cursor-pointer"><input type="checkbox" name="q10" value="b" class="mr-2"> 500L + 200B = 3800</label>
                            <label class="flex items-center cursor-pointer"><input type="checkbox" name="q10" value="c" class="mr-2"> 500L + 200B = 10</label>
                            <label class="flex items-center cursor-pointer"><input type="checkbox" name="q10" value="d" class="mr-2"> L + B = 10</label>
                        </div>
                        <div class="feedback hidden mt-2 text-xs p-2 rounded"></div>
                    </div>
                </div>

                <!-- Botones -->
                <div class="mt-8 text-center flex flex-col md:flex-row gap-4 justify-center no-print">
                    <button type="button" onclick="calculateScore()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all">
                        ‚úÖ Calificar y Enviar
                    </button>
                    <button type="button" onclick="window.print()" class="bg-amber-800 hover:bg-amber-900 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all">
                        üñ®Ô∏è Imprimir
                    </button>
                </div>
            </form>

            <!-- RESULTADOS (Oculto inicialmente) -->
            <div id="results-area" class="hidden mt-8 p-6 bg-stone-100 rounded-xl border border-stone-300 text-center">
                <h3 class="text-2xl font-bold text-amber-900 mb-2">Resultados de <span id="res-name"></span></h3>
                <div class="text-4xl font-bold mb-4" id="res-score">0 / 10</div>
                <p id="res-msg" class="text-gray-700 font-medium"></p>
                <p class="text-sm text-gray-500 mt-2">Revisa las correcciones arriba ‚¨ÜÔ∏è</p>
            </div>

        </div>
    </section>

    <!-- FOOTER -->
    <footer class="bg-stone-900 text-stone-400 py-8 text-center mt-12 no-print">
        <p class="text-sm">¬© 2023 CafeLab Educaci√≥n. Pasito a pasito se llega lejos.</p>
    </footer>

    <!-- L√ìGICA JAVASCRIPT CON ENV√çO DE DATOS -->
    <script>
        // CONFIGURACI√ìN DEL SERVIDOR GOOGLE SHEETS
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycby8RZ3TxQSm8yOsb3JtAT0EwKMQF3cehZnVqNSnPiN_ew3gyEknFD96CL2pvG575gm9zg/exec";

        const correctAnswers = {
            q1: { ans: 'b', explain: 'Correcto: "Aumentar" significa sumar. Al precio (p) le sumamos 500.' },
            q2: { ans: 'c', explain: 'Correcto: "El triple" significa multiplicar por 3. (3x).' },
            q3: { ans: 'a', explain: 'Correcto: "Merma" es p√©rdida o resta. A la cosecha (c) le quitamos 10.' },
            q4: { ans: 'c', explain: 'Correcto: "Repartir" es dividir. Ganancia (g) dividido 4.' },
            q5: { ans: 'b', explain: 'Correcto: El par√©ntesis agrupa la suma (w+5) antes de duplicarla.' },
            q6: { ans: 'a', explain: 'Correcto: Jerarqu√≠a de operaciones: primero multiplicamos 2x10=20, luego restamos 100-20=80.' },
            q7: { ans: 'a', explain: 'Correcto: La coma separa las ideas. Primero "mitad de precio" (p/2), y aparte sumamos el impuesto (+t).' },
            q8: { ans: 'a', explain: 'Correcto: Si 3 sacos cuestan 1500, dividimos 1500 entre 3 para saber el valor de uno. x=500.' },
            q9: { ans: ['r+v=50', 'v+r=50', 'r + v = 50', 'v + r = 50'], explain: 'Correcto: La suma de las dos cantidades da el total.' },
            q10: { ans: ['b', 'd'], explain: 'Correcto: Una ecuaci√≥n suma cantidades (L+B=10) y la otra suma dinero (500L+200B=3800).' }
        };

        function calculateScore() {
            const nameInput = document.getElementById('studentName').value;
            if (!nameInput.trim()) {
                alert("‚ö†Ô∏è Por favor, escribe tu nombre antes de calificar.");
                document.getElementById('studentName').focus();
                return;
            }

            // Cambiar estado del bot√≥n
            const btn = document.querySelector('button[onclick="calculateScore()"]');
            btn.innerHTML = "‚è≥ Enviando...";
            btn.disabled = true;

            let score = 0;
            let detailAnswers = []; 
            const form = document.getElementById('quizForm');

            // Limpiar feedback previo
            document.querySelectorAll('.feedback').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');
                el.parentElement.classList.remove('correct-answer', 'wrong-answer', 'border-2', 'p-2');
            });

            // Evaluar Q1 a Q8
            for (let i = 1; i <= 8; i++) {
                const qKey = 'q' + i;
                const selected = form.querySelector(`input[name="${qKey}"]:checked`);
                const box = document.getElementById(qKey + '-box');
                const feedbackDiv = box.querySelector('.feedback');
                
                let val = selected ? selected.value : "-";
                let isCorrect = false;
                if (selected && selected.value === correctAnswers[qKey].ans) {
                    isCorrect = true;
                    score++;
                }
                
                detailAnswers.push(`${qKey}: ${val} (${isCorrect ? 'OK' : 'X'})`);

                // Feedback Visual
                box.classList.add('border-2', 'p-2', 'rounded');
                feedbackDiv.classList.remove('hidden');
                if (isCorrect) {
                    box.classList.add('correct-answer');
                    feedbackDiv.innerHTML = `‚úÖ ${correctAnswers[qKey].explain}`;
                    feedbackDiv.classList.add('bg-green-100', 'text-green-800');
                } else {
                    box.classList.add('wrong-answer');
                    feedbackDiv.innerHTML = `‚ùå Error. ${correctAnswers[qKey].explain}`;
                    feedbackDiv.classList.add('bg-red-100', 'text-red-800');
                }
            }

            // Evaluar Q9
            const q9Input = document.getElementById('q9_input').value;
            const q9Clean = q9Input.toLowerCase().replace(/\s/g, '');
            const q9Valid = correctAnswers.q9.ans.map(a => a.replace(/\s/g, ''));
            const q9Box = document.getElementById('q9-box');
            const q9Feedback = q9Box.querySelector('.feedback');
            q9Box.classList.add('border-2', 'p-2', 'rounded');
            q9Feedback.classList.remove('hidden');

            let isQ9Correct = false;
            if (q9Valid.includes(q9Clean)) {
                score++;
                isQ9Correct = true;
                q9Box.classList.add('correct-answer');
                q9Feedback.innerHTML = `‚úÖ ${correctAnswers.q9.explain}`;
                q9Feedback.classList.add('bg-green-100', 'text-green-800');
            } else {
                q9Box.classList.add('wrong-answer');
                q9Feedback.innerHTML = `‚ùå Respuesta esperada: R + V = 50`;
                q9Feedback.classList.add('bg-red-100', 'text-red-800');
            }
            detailAnswers.push(`Q9: ${q9Input} (${isQ9Correct ? 'OK' : 'X'})`);

            // Evaluar Q10
            const q10Selected = Array.from(form.querySelectorAll('input[name="q10"]:checked')).map(cb => cb.value);
            const correctSet = correctAnswers.q10.ans;
            const isQ10Correct = q10Selected.length === 2 && q10Selected.every(val => correctSet.includes(val));
            const q10Box = document.getElementById('q10-box');
            const q10Feedback = q10Box.querySelector('.feedback');
            q10Box.classList.add('border-2', 'p-2', 'rounded');
            q10Feedback.classList.remove('hidden');

            if (isQ10Correct) {
                score++;
                q10Box.classList.add('correct-answer');
                q10Feedback.innerHTML = `‚úÖ ${correctAnswers.q10.explain}`;
                q10Feedback.classList.add('bg-green-100', 'text-green-800');
            } else {
                q10Box.classList.add('wrong-answer');
                q10Feedback.innerHTML = `‚ùå Debes seleccionar las dos ecuaciones correctas.`;
                q10Feedback.classList.add('bg-red-100', 'text-red-800');
            }
            detailAnswers.push(`Q10: [${q10Selected.join(',')}] (${isQ10Correct ? 'OK' : 'X'})`);

            // MOSTRAR RESULTADOS
            const resultsArea = document.getElementById('results-area');
            resultsArea.classList.remove('hidden');
            document.getElementById('res-name').textContent = nameInput;
            document.getElementById('res-score').textContent = score + " / 10";
            
            const msgEl = document.getElementById('res-msg');
            if(score === 10) msgEl.textContent = "¬°Perfecto! Enviando resultados...";
            else if(score >= 7) msgEl.textContent = "¬°Muy bien! Enviando resultados...";
            else msgEl.textContent = "Sigue practicando. Enviando resultados...";

            resultsArea.scrollIntoView({ behavior: 'smooth' });

            // ENVIAR A GOOGLE SHEETS
            const dataToSend = JSON.stringify({
                nombre: nameInput,
                puntaje: score,
                respuestas: detailAnswers.join(" | ")
            });

            fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                mode: "no-cors", 
                headers: { "Content-Type": "application/json" },
                body: dataToSend
            }).then(() => {
                btn.innerHTML = "‚úÖ Calificado y Enviado";
                alert(`¬°Examen enviado correctamente!\nEstudiante: ${nameInput}\nNota: ${score}/10`);
            }).catch(err => {
                console.error("Error env√≠o", err);
                btn.innerHTML = "‚ö†Ô∏è Error de conexi√≥n";
                alert("Se calcul√≥ tu nota, pero hubo un error al enviarla a la base de datos.");
            });
        }
    </script>

</body>
</html>
